# change_arm_mode.py

### 代码说明

#### 功能
该代码实现了一个 ROS 客户端，用于设置 OCS2 手臂的控制模式。用户可以通过调用相应的服务来更改手臂的控制模式，支持保持姿势、自动摆手和外部控制三种模式。

#### 代码参数
- **mode (int)**: 要设置的控制模式，取值范围为：
  - `0`: 保持姿势（keep pose）
  - `1`: 行走时自动摆手（auto_swing_arm）
  - `2`: 外部控制（external_control）

#### 逻辑
1. **导入库**:
   - 导入 `rospy` 库以使用 ROS 的 Python 接口。
   - 导入 `changeArmCtrlMode` 服务相关的消息类型。

2. **定义设置控制模式的函数**:
   - `set_arm_control_mode(mode)`:
     - 创建服务代理 `arm_traj_change_mode_client`，用于与 `/arm_traj_change_mode` 服务进行通信。
     - 创建请求对象 `changeArmCtrlModeRequest`，并设置要更改的控制模式。
     - 发送请求并接收响应。
     - 根据响应结果记录成功或失败的信息。
     - 如果服务调用失败，记录错误信息。

3. **主程序**:
   - `main()`:
     - 初始化 ROS 节点，节点名称为 `arm_control_mode_client`。
     - 设置要更改的控制模式（示例中为 `2`，即外部控制）。
     - 调用 `set_arm_control_mode` 函数以更改手臂控制模式。

4. **入口点**:
   - 如果此脚本是主程序，则调用 `main()` 函数。

### 总结
该代码提供了一个简单的接口，用于通过 ROS 服务设置 OCS2 手臂的控制模式，用户可以方便地选择不同的控制模式以适应不同的操作需求。


# use_target_control.py
### 代码说明
- 需要切换到模式2
- 14个关节分别为左手7个电机+右手7个电机，代码执行会在给定时间完成给定的运动指令

#### 功能
该代码实现了一个 ROS 节点，用于发布手臂的目标姿态到指定的话题 `kuavo_arm_target_poses`。用户可以通过设置时间和关节角度列表来控制手臂的运动。

#### 代码参数
- **pub (Publisher)**: ROS Publisher 对象，用于发布消息。
- **times (list)**: 时间列表，表示每个关节角度的时间点。
- **values (list)**: 关节角度列表，表示手臂各个关节的目标角度。

#### 逻辑
1. **导入库**:
   - 导入 `rospy` 库以使用 ROS 的 Python 接口。
   - 导入 `armTargetPoses` 消息类型，用于定义手臂目标姿态消息。

2. **定义发布目标姿态的函数**:
   - `publish_arm_target_poses(pub, times, values)`:
     - 创建 `armTargetPoses` 消息对象，并设置传入的 `times` 和 `values`。
     - 记录日志，表示正在发布目标姿态。
     - 等待订阅者连接，直到有订阅者连接到话题。
     - 发布消息，并记录日志，表示消息已成功发布。

3. **主程序**:
   - `main()`:
     - 初始化 ROS 节点，节点名称为 `arm_target_poses_publisher`。
     - 创建 Publisher 对象，订阅话题 `kuavo_arm_target_poses`，消息类型为 `armTargetPoses`。
     - 确保 Publisher 注册后，调用 `publish_arm_target_poses` 函数，传入时间和关节角度列表。

4. **入口点**:
   - 如果此脚本是主程序，则调用 `main()` 函数，并处理可能的 ROS 中断异常。

### 总结
该代码提供了一个简单的接口，用于通过 ROS 发布手臂的目标姿态，用户可以方便地设置时间和关节角度以控制手臂的运动。通过等待订阅者连接，确保消息能够被及时接收。

# use_traj_control.py

### 代码说明
- 用于实现自定义关节轨迹插值以及实时目标手臂动作规划，如VR遥操

#### 功能
该代码实现了一个 ROS 节点，用于生成并发布关节状态消息到指定话题 `/kuavo_arm_traj`。它通过线性插值生成从初始关节位置到目标关节位置的轨迹，并以指定频率发布这些位置。

#### 代码参数
- **q_now (list)**: 当前关节位置列表，包含 14 个关节的角度值。
- **q0 (list)**: 初始关节位置列表，包含 14 个关节的初始角度值。
- **q1 (list)**: 目标关节位置列表，包含 14 个关节的目标角度值。
- **num (int)**: 插值步数，表示生成的插值点数量。

#### 逻辑
1. **导入库**:
   - 导入 `rospy` 库以使用 ROS 的 Python 接口。
   - 导入 `JointState` 消息类型，用于定义关节状态消息。
   - 导入 `numpy` 库用于数组操作。
   - 导入 `time` 库用于控制时间延迟。

2. **定义发布关节状态的函数**:
   - `publish_joint_states(q_now)`:
     - 创建一个 Publisher，发布到 `/kuavo_arm_traj` 话题，消息类型为 `JointState`。
     - 设置关节名称为 `["arm_joint_1", ..., "arm_joint_14"]`。
     - 设置消息的时间戳为当前时间。
     - 设置关节位置为传入的 `q_now` 列表。
     - 确保关节位置数组长度为 14。
     - 发布消息。

3. **定义插值函数**:
   - `interpolate_joint_positions(q0, q1, num)`:
     - 生成从 `q0` 到 `q1` 的插值轨迹。
     - 通过线性插值计算每个关节的位置，并将计算出的关节位置添加到列表中。
     - 返回插值后的关节位置序列。

4. **主程序**:
   - `main()`:
     - 初始化 ROS 节点，节点名称为 `sim_traj`。
     - 设置发布频率为 10Hz。
     - 定义初始关节位置 `q0` 和目标关节位置 `q1`，前 7 个关节的目标位置被设置为特定值。
     - 调用插值函数生成关节位置序列 `q_list`。
     - 遍历 `q_list`，发布每个插值后的关节位置，并打印当前关节位置。
     - 等待 20 毫秒以控制发布频率。

5. **入口点**:
   - 如果此脚本是主程序，则调用 `main()` 函数，并处理可能的 ROS 中断异常。

### 总结
该代码提供了一个简单的接口，用于通过 ROS 发布关节状态，用户可以方便地生成并发布关节的插值轨迹，以控制机械臂的运动。通过线性插值，确保关节位置在初始和目标位置之间平滑过渡。